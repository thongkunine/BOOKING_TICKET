<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thêm sự kiện - Admin Panel</title>
    <link rel="stylesheet" href="/public/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <h2>Admin Panel</h2>
            </div>
            <div class="sidebar-divider"></div>
            <ul class="menu">
                <li>
                    <a href="users.html">
                        <i class="fas fa-users"></i>
                        <span>Quản lý người dùng</span>
                    </a>
                </li>
                <li class="active">
                    <a href="events.html">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Quản lý sự kiện</span>
                    </a>
                </li>
                <li>
                    <a href="tickets.html">
                        <i class="fas fa-ticket-alt"></i>
                        <span>Quản lý vé</span>
                    </a>
                </li>
                <li>
                    <a href="payments.html">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>Quản lý giao dịch</span>
                    </a>
                </li>
                <li>
                    <a href="reports.html">
                        <i class="fas fa-chart-bar"></i>
                        <span>Báo cáo thống kê</span>
                    </a>
                </li>
            </ul>
            <div class="sidebar-divider"></div>
            <div class="sidebar-footer">
                <p>© 2025 Admin Panel</p>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <div class="header-left">
                    <button class="filter-button" onclick="window.history.back()">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <h1>Thêm sự kiện mới</h1>
                </div>
                <div class="header-right">
                    <div class="admin-profile">
                        <img src="/admin-avatar.png" alt="Admin">
                        <span>Admin</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
            </div>

            <!-- Content Area -->
            <div class="content-area">
                <div class="add-event-container">
                    <div class="add-event-card">
                        <form id="addEventForm" class="add-form">
                            <!-- Image Upload Section -->
                            <div class="form-section image-upload-section">
                                <div class="image-upload-container">
                                    <div class="image-preview" id="imagePreview">
                                        <div class="image-placeholder">
                                            <i class="fas fa-image"></i>
                                            <span>Tải lên ảnh sự kiện</span>
                                        </div>
                                    </div>
                                    <input
                                        type="file"
                                        id="event-image"
                                        accept="image/*"
                                        class="image-input"
                                    />
                                    <label for="event-image" class="image-upload-btn">
                                        <i class="fas fa-upload"></i>
                                        Chọn ảnh
                                    </label>
                                    <button
                                        type="button"
                                        class="image-remove-btn"
                                        id="removeImageBtn"
                                        style="display: none;"
                                    >
                                        <i class="fas fa-trash"></i>
                                        Xóa ảnh
                                    </button>
                                </div>
                            </div>

                            <!-- Basic Info Section -->
                            <div class="form-section">
                                <h3>Thông tin cơ bản</h3>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label>
                                            <i class="fas fa-signature"></i>
                                            Tên sự kiện
                                        </label>
                                        <input
                                            type="text"
                                            name="name"
                                            class="form-input"
                                            placeholder="Nhập tên sự kiện"
                                            required
                                        />
                                    </div>

                                    <div class="form-group">
                                        <label>
                                            <i class="fas fa-tag"></i>
                                            Phân loại
                                        </label>
                                        <select name="category" class="form-select" required>
                                            <option value="Âm nhạc">Âm nhạc</option>
                                            <option value="Hội thảo">Hội thảo</option>
                                            <option value="Thể thao">Thể thao</option>
                                            <option value="Từ thiện">Từ thiện</option>
                                        </select>
                                    </div>

                                    <div class="form-group">
                                        <label>
                                            <i class="fas fa-map-marker-alt"></i>
                                            Địa điểm
                                        </label>
                                        <input
                                            type="text"
                                            name="location"
                                            class="form-input"
                                            placeholder="Nhập địa điểm tổ chức"
                                            required
                                        />
                                    </div>
                                </div>
                            </div>

                            <!-- Time Section -->
                            <div class="form-section">
                                <h3>Thời gian</h3>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label>
                                            <i class="fas fa-clock"></i>
                                            Thời gian bắt đầu
                                        </label>
                                        <input
                                            type="datetime-local"
                                            name="startTime"
                                            class="form-input"
                                            required
                                        />
                                    </div>

                                    <div class="form-group">
                                        <label>
                                            <i class="fas fa-clock"></i>
                                            Thời gian kết thúc
                                        </label>
                                        <input
                                            type="datetime-local"
                                            name="endTime"
                                            class="form-input"
                                            required
                                        />
                                    </div>
                                </div>
                            </div>

                            <!-- Settings Section -->
                            <div class="form-section">
                                <h3>Cài đặt</h3>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label>
                                            <i class="fas fa-globe"></i>
                                            Trạng thái
                                        </label>
                                        <select name="status" class="form-select">
                                            <option value="Công khai">Công khai</option>
                                            <option value="Nháp">Nháp</option>
                                        </select>
                                    </div>

                                    <div class="form-group checkbox-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" name="featured" />
                                            <i class="fas fa-star"></i>
                                            Đánh dấu là sự kiện nổi bật
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Description Section -->
                            <div class="form-section">
                                <h3>Mô tả</h3>
                                <div class="form-group">
                                    <textarea
                                        name="description"
                                        class="form-textarea"
                                        placeholder="Nhập mô tả chi tiết về sự kiện..."
                                        rows="4"
                                        required
                                    ></textarea>
                                </div>
                            </div>

                            <!-- Ticket Section -->
                            <div class="form-section">
                                <div class="section-header">
                                    <h3>Loại vé</h3>
                                    <button 
                                        type="button" 
                                        class="add-ticket-btn"
                                        onclick="addTicketType()"
                                    >
                                        <i class="fas fa-plus"></i>
                                        Thêm loại vé
                                    </button>
                                </div>
                                
                                <div id="ticketContainer">
                                    <!-- Initial ticket form -->
                                    <div class="ticket-form">
                                        <div class="form-grid">
                                            <div class="form-group">
                                                <label>Tên loại vé</label>
                                                <input
                                                    type="text"
                                                    name="ticket-name-0"
                                                    class="form-input"
                                                    placeholder="VIP, Thường,..."
                                                    required
                                                />
                                            </div>
                                            <div class="form-group">
                                                <label>Giá vé (VND)</label>
                                                <input
                                                    type="number"
                                                    name="ticket-price-0"
                                                    class="form-input"
                                                    placeholder="Nhập giá vé"
                                                    required
                                                />
                                            </div>
                                            <div class="form-group">
                                                <label>Số lượng</label>
                                                <input
                                                    type="number"
                                                    name="ticket-quantity-0"
                                                    class="form-input"
                                                    placeholder="Nhập số lượng"
                                                    required
                                                />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Form Buttons -->
                            <div class="form-buttons">
                                <button type="submit" class="submit-btn">
                                    <i class="fas fa-plus"></i>
                                    Tạo sự kiện
                                </button>
                                <button 
                                    type="button" 
                                    class="cancel-btn"
                                    onclick="window.location.href='events.html'"
                                >
                                    <i class="fas fa-times"></i>
                                    Hủy
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Handle image preview
        const imageInput = document.getElementById('event-image');
        const imagePreview = document.getElementById('imagePreview');
        const removeImageBtn = document.getElementById('removeImageBtn');
        let currentImage = null;

        imageInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onloadend = function() {
                    imagePreview.innerHTML = `<img src="${reader.result}" alt="Event Preview">`;
                    removeImageBtn.style.display = 'block';
                    currentImage = file;
                };
                reader.readAsDataURL(file);
            }
        });

        removeImageBtn.addEventListener('click', function() {
            imagePreview.innerHTML = `
                <div class="image-placeholder">
                    <i class="fas fa-image"></i>
                    <span>Tải lên ảnh sự kiện</span>
                </div>
            `;
            imageInput.value = '';
            removeImageBtn.style.display = 'none';
            currentImage = null;
        });

        // Handle ticket types
        let ticketCount = 1;

        function addTicketType() {
            const ticketContainer = document.getElementById('ticketContainer');
            const newTicket = document.createElement('div');
            newTicket.className = 'ticket-form';
            newTicket.innerHTML = `
                <div class="form-grid">
                    <div class="form-group">
                        <label>Tên loại vé</label>
                        <input
                            type="text"
                            name="ticket-name-${ticketCount}"
                            class="form-input"
                            placeholder="VIP, Thường,..."
                            required
                        />
                    </div>
                    <div class="form-group">
                        <label>Giá vé (VND)</label>
                        <input
                            type="number"
                            name="ticket-price-${ticketCount}"
                            class="form-input"
                            placeholder="Nhập giá vé"
                            required
                        />
                    </div>
                    <div class="form-group">
                        <label>Số lượng</label>
                        <input
                            type="number"
                            name="ticket-quantity-${ticketCount}"
                            class="form-input"
                            placeholder="Nhập số lượng"
                            required
                        />
                    </div>
                    <button
                        type="button"
                        class="remove-ticket-btn"
                        onclick="removeTicketType(this)"
                    >
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            ticketContainer.appendChild(newTicket);
            ticketCount++;
        }

        function removeTicketType(button) {
            button.closest('.ticket-form').remove();
        }

        // Handle form submission
        document.getElementById('addEventForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Collect form data
            const formData = new FormData(this);
            const tickets = [];
            
            // Add image if exists
            if (currentImage) {
                formData.append('image', currentImage);
            }

            // Collect ticket data
            for (let i = 0; i < ticketCount; i++) {
                const nameInput = document.querySelector(`[name="ticket-name-${i}"]`);
                const priceInput = document.querySelector(`[name="ticket-price-${i}"]`);
                const quantityInput = document.querySelector(`[name="ticket-quantity-${i}"]`);
                
                if (nameInput && priceInput && quantityInput) {
                    tickets.push({
                        name: nameInput.value,
                        price: priceInput.value,
                        quantity: quantityInput.value
                    });
                }
            }

            // Create event object
            const eventData = {
                name: formData.get('name'),
                category: formData.get('category'),
                location: formData.get('location'),
                startTime: formData.get('startTime'),
                endTime: formData.get('endTime'),
                status: formData.get('status'),
                featured: formData.get('featured') === 'on',
                description: formData.get('description'),
                tickets: tickets
            };

            // Log the data (in real application, this would be an API call)
            console.log('Tạo sự kiện mới:', eventData);
            alert('Đã tạo sự kiện thành công!');
            window.location.href = 'events.html';
        });

        // Validate end time is after start time
        const startTimeInput = document.querySelector('input[name="startTime"]');
        const endTimeInput = document.querySelector('input[name="endTime"]');

        function validateDateTime() {
            if (startTimeInput.value && endTimeInput.value) {
                const startTime = new Date(startTimeInput.value);
                const endTime = new Date(endTimeInput.value);
                
                if (endTime <= startTime) {
                    endTimeInput.setCustomValidity('Thời gian kết thúc phải sau thời gian bắt đầu');
                } else {
                    endTimeInput.setCustomValidity('');
                }
            }
        }

        startTimeInput.addEventListener('change', validateDateTime);
        endTimeInput.addEventListener('change', validateDateTime);

        // Set minimum date for datetime inputs
        const now = new Date();
        const tzOffset = now.getTimezoneOffset() * 60000;
        const localISOTime = (new Date(Date.now() - tzOffset)).toISOString().slice(0, 16);
        
        startTimeInput.min = localISOTime;
        endTimeInput.min = localISOTime;
    </script>
</body>
</html> 