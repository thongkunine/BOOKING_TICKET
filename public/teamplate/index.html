<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Badminton Events - Trang chủ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        .navbar {
            background-color: #343a40;
            box-shadow: 0 2px 4px rgba(0,0,0,.1);
        }
        .navbar-brand {
            font-weight: bold;
            color: #fff !important;
        }
        .nav-link {
            color: rgba(255,255,255,.8) !important;
        }
        .nav-link:hover {
            color: #fff !important;
        }
        .hero-section {
            background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('https://images.unsplash.com/photo-1626224583764-f87db24ac4ea?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 100px 0;
            text-align: center;
            margin-bottom: 40px;
        }
        .hero-section h1 {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .hero-section p {
            font-size: 1.2rem;
            margin-bottom: 30px;
        }
        .event-card {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            transition: transform 0.3s;
        }
        .event-card:hover {
            transform: translateY(-5px);
        }
        .event-card img {
            height: 200px;
            object-fit: cover;
        }
        .event-card .card-body {
            padding: 20px;
        }
        .event-card .card-title {
            font-weight: bold;
            margin-bottom: 10px;
        }
        .event-card .card-text {
            color: #6c757d;
            margin-bottom: 15px;
        }
        .event-card .badge {
            margin-right: 5px;
        }
        .btn-primary {
            background-color: #4a90e2;
            border: none;
        }
        .btn-primary:hover {
            background-color: #357abd;
        }
        .footer {
            background-color: #343a40;
            color: white;
            padding: 40px 0;
            margin-top: 50px;
        }
        .footer h5 {
            font-weight: bold;
            margin-bottom: 20px;
        }
        .footer ul {
            list-style: none;
            padding: 0;
        }
        .footer ul li {
            margin-bottom: 10px;
        }
        .footer ul li a {
            color: rgba(255,255,255,.8);
            text-decoration: none;
        }
        .footer ul li a:hover {
            color: white;
        }
        .social-icons a {
            color: white;
            margin-right: 15px;
            font-size: 20px;
        }
        .social-icons a:hover {
            color: #4a90e2;
        }
        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }
        .loading i {
            font-size: 24px;
            color: #4a90e2;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .alert {
            display: none;
            margin-top: 20px;
            border-radius: 8px;
        }
        .event-details {
            display: none;
        }
        .event-details.active {
            display: block;
        }
        .seat-selection {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        .seat {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        .seat.available {
            background-color: #28a745;
            color: white;
        }
        .seat.selected {
            background-color: #4a90e2;
            color: white;
        }
        .seat.unavailable {
            background-color: #dc3545;
            color: white;
            cursor: not-allowed;
        }
        .seat:hover:not(.unavailable) {
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">Badminton Events</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#">Trang chủ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Sự kiện</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Về chúng tôi</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Liên hệ</a>
                    </li>
                    <li class="nav-item" id="loginNavItem">
                        <a class="nav-link" href="login/login_signup/login.html">Đăng nhập</a>
                    </li>
                    <li class="nav-item" id="signupNavItem">
                        <a class="nav-link" href="login/login_signup/signup.html">Đăng ký</a>
                    </li>
                    <li class="nav-item dropdown" id="userNavItem" style="display: none;">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user"></i> <span id="userDisplayName">User</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="login/login_signup/profile.html" id="profileLink">Hồ sơ</a></li>
                            <li><a class="dropdown-item" href="" id="ordersLink">Đơn hàng</a></li>
                            <li id="adminLinkContainer" style="display: none;"><a class="dropdown-item" href="admin/admin.html" id="adminLink">Admin</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" id="logoutLink">Đăng xuất</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <h1>Khám phá các sự kiện cầu lông</h1>
            <p>Đặt vé và tham gia các giải đấu cầu lông hấp dẫn</p>
            <a href="#events" class="btn btn-primary btn-lg">Xem sự kiện</a>
        </div>
    </section>

    <!-- Events Section -->
    <section id="events" class="py-5">
        <div class="container">
            <h2 class="text-center mb-5">Sự kiện sắp diễn ra</h2>
            
            <!-- Alert messages -->
            <div class="alert alert-success" id="successAlert" role="alert"></div>
            <div class="alert alert-danger" id="errorAlert" role="alert"></div>
            
            <!-- Loading indicator -->
            <div class="loading" id="loading">
                <i class="fas fa-spinner"></i> Đang tải...
            </div>
            
            <!-- Events List -->
            <div class="row" id="eventsList">
                <!-- Events will be loaded here -->
            </div>
            
            <!-- Event Details -->
            <div class="event-details" id="eventDetails">
                <div class="row">
                    <div class="col-md-8">
                        <h3 id="eventName">Tên sự kiện</h3>
                        <p id="eventDate">Ngày: </p>
                        <p id="eventLocation">Địa điểm: </p>
                        <p id="eventDescription">Mô tả: </p>
                        
                        <h4 class="mt-4">Chọn ghế</h4>
                        <div class="seat-selection" id="seatSelection">
                            <!-- Seats will be loaded here -->
                        </div>
                        
                        <div class="mt-4">
                            <h5>Ghế đã chọn: <span id="selectedSeats">Không có</span></h5>
                            <h5>Tổng tiền: <span id="totalPrice">0</span> VNĐ</h5>
                            <button class="btn btn-primary" id="bookButton">Đặt vé</button>
                            <button class="btn btn-secondary" id="backButton">Quay lại</button>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Thông tin đặt vé</h5>
                                <div id="loginMessage">
                                    
                                    <p class="card-text">Vui lòng đăng nhập để đặt vé.</p>
                                    <a href="login/login_signup/login.html" class="btn btn-primary">Đăng nhập</a>
                                </div>
                                <div id="bookingInfo" style="display: none">
                                    <p class="card-text">Bạn có thể đặt vé ngay bây giờ.</p>
                                    <p class="card-text">Vui lòng chọn ghế và số lượng vé mong muốn.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <h5>Badminton Events</h5>
                    <p>Nền tảng đặt vé cho các sự kiện cầu lông hàng đầu Việt Nam.</p>
                    <div class="social-icons">
                        <a href="https://www.facebook.com/ThongKunine"><i class="fab fa-facebook"></i></a>
                        <a href="https://www.facebook.com/ThongKunine"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.instagram.com/mithon.dmt/"><i class="fab fa-instagram"></i></a>
                        <a href="https://www.facebook.com/ThongKunine"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                <div class="col-md-4">
                    <h5>Liên kết nhanh</h5>
                    <ul>
                        <li><a href="index.html">Trang chủ</a></li>
                        <li><a href="user/event.html">Sự kiện</a></li>
                        <li><a href="#">Về chúng tôi</a></li>
                        <li><a href="#">Liên hệ</a></li>
                        <li><a href="#">Điều khoản sử dụng</a></li>
                        <li><a href="#">Chính sách bảo mật</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5>Liên hệ</h5>
                    <ul>
                        <li><i class="fas fa-map-marker-alt"></i> 123 Đường ABC, Quận XYZ, Hà Nội</li>
                        <li><i class="fas fa-phone"></i> +84 123 456 789</li>
                        <li><i class="fas fa-envelope"></i> info@badmintonevents.com</li>
                    </ul>
                </div>
            </div>
            <hr>
            <div class="text-center">
                <p>&copy; 2023 Badminton Events. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const eventsList = document.getElementById('eventsList');
            const eventDetails = document.getElementById('eventDetails');
            const loading = document.getElementById('loading');
            const successAlert = document.getElementById('successAlert');
            const errorAlert = document.getElementById('errorAlert');
            const seatSelection = document.getElementById('seatSelection');
            const selectedSeatsDisplay = document.getElementById('selectedSeats');
            const totalPriceDisplay = document.getElementById('totalPrice');
            const bookButton = document.getElementById('bookButton');
            const backButton = document.getElementById('backButton');
            
            // Kiểm tra trạng thái đăng nhập
            const token = localStorage.getItem('token');
            const loginNavItem = document.getElementById('loginNavItem');
            const signupNavItem = document.getElementById('signupNavItem');
            const userNavItem = document.getElementById('userNavItem');
            const userDisplayName = document.getElementById('userDisplayName');

            if (token) {
                // Nếu đã đăng nhập
                loginNavItem.style.display = 'none';
                signupNavItem.style.display = 'none';
                userNavItem.style.display = 'block';
                
                // Hiển thị thông tin đặt vé cho người dùng đã đăng nhập
                document.getElementById('loginMessage').style.display = 'none';
                document.getElementById('bookingInfo').style.display = 'block';

                // Lấy thông tin người dùng
                fetch('http://localhost:4000/auth/me', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        userDisplayName.textContent = data.data.username;
                        
                        // Kiểm tra vai trò người dùng
                        const userRole = data.data.role?.name || data.data.role;
                        console.log('User role:', userRole);
                        
                        // Hiển thị nút Admin nếu người dùng là admin
                        if (userRole === 'admin' || userRole === 'Admin' || userRole === 'Administrator') {
                            document.getElementById('adminLinkContainer').style.display = 'block';
                        } else {
                            document.getElementById('adminLinkContainer').style.display = 'none';
                        }
                    }
                })
                .catch(error => {
                    console.error('Error fetching user data:', error);
                    localStorage.removeItem('token');
                    window.location.reload();
                });

                // Xử lý đăng xuất
                document.getElementById('logoutLink').addEventListener('click', function(e) {
                    e.preventDefault();
                    localStorage.removeItem('token');
                    window.location.reload();
                });
            } else {
                // Nếu chưa đăng nhập
                loginNavItem.style.display = 'block';
                signupNavItem.style.display = 'block';
                userNavItem.style.display = 'none';
                
                // Hiển thị thông tin đặt vé cho người dùng chưa đăng nhập
                document.getElementById('loginMessage').style.display = 'block';
                document.getElementById('bookingInfo').style.display = 'none';
            }
            
            // Hiển thị loading
            loading.style.display = 'block';
            
            // Lấy danh sách sự kiện từ API
            fetch('http://localhost:4000/events')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Không thể tải danh sách sự kiện. Vui lòng thử lại sau.');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        displayEvents(data.data);
                    } else {
                        throw new Error(data.message || 'Không thể tải danh sách sự kiện.');
                    }
                })
                .catch(error => {
                    console.error('Error fetching events:', error);
                    errorAlert.textContent = error.message || 'Đã xảy ra lỗi khi tải danh sách sự kiện.';
                    errorAlert.style.display = 'block';
                    loading.style.display = 'none';
                });
            
            // Hiển thị danh sách sự kiện
            function displayEvents(events) {
                eventsList.innerHTML = '';
                
                if (events.length === 0) {
                    eventsList.innerHTML = '<div class="col-12 text-center"><p>Không có sự kiện nào sắp diễn ra.</p></div>';
                    loading.style.display = 'none';
                    return;
                }
                
                events.forEach(event => {
                    const eventCard = document.createElement('div');
                    eventCard.className = 'col-md-4';
                    eventCard.innerHTML = `
                        <div class="card event-card">
                            <img src="${event.image || 'https://images.unsplash.com/photo-1626224583764-f87db24ac4ea?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80'}" class="card-img-top" alt="${event.name}">
                            <div class="card-body">
                                <h5 class="card-title">${event.name}</h5>
                                <p class="card-text">
                                    <i class="fas fa-calendar-alt"></i> ${new Date(event.date).toLocaleDateString()}<br>
                                    <i class="fas fa-map-marker-alt"></i> ${event.location}
                                </p>
                                <p class="card-text">${event.description ? event.description.substring(0, 100) + '...' : 'Không có mô tả'}</p>
                                <button class="btn btn-primary view-event" data-id="${event._id}">Xem chi tiết</button>
                            </div>
                        </div>
                    `;
                    eventsList.appendChild(eventCard);
                });
                
                // Thêm sự kiện cho nút xem chi tiết
                document.querySelectorAll('.view-event').forEach(button => {
                    button.addEventListener('click', function() {
                        const eventId = this.getAttribute('data-id');
                        loadEventDetails(eventId);
                    });
                });
                
                // Ẩn loading
                loading.style.display = 'none';
            }
            
            // Lấy chi tiết sự kiện từ API
            function loadEventDetails(eventId) {
                // Hiển thị loading
                loading.style.display = 'block';
                
                // Lấy thông tin sự kiện
                fetch(`http://localhost:4000/events/${eventId}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Không thể tải thông tin sự kiện. Vui lòng thử lại sau.');
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.success) {
                            const event = data.data;
                            
                            // Lưu ID sự kiện hiện tại
                            currentEventId = event._id;
                            
                            // Cập nhật thông tin sự kiện
                            document.getElementById('eventName').textContent = event.name;
                            document.getElementById('eventDate').textContent = `Ngày: ${new Date(event.date).toLocaleDateString()}`;
                            document.getElementById('eventLocation').textContent = `Địa điểm: ${event.location}`;
                            document.getElementById('eventDescription').textContent = `Mô tả: ${event.description || 'Không có mô tả'}`;
                            
                            // Lấy danh sách ghế cho sự kiện
                            return fetch(`http://localhost:4000/seats/event/${eventId}`);
                        } else {
                            throw new Error(data.message || 'Không thể tải thông tin sự kiện.');
                        }
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Không thể tải danh sách ghế. Vui lòng thử lại sau.');
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.success) {
                            // Hiển thị danh sách ghế
                            displaySeats(data.data);
                            
                            // Hiển thị phần chi tiết sự kiện
                            eventsList.style.display = 'none';
                            eventDetails.style.display = 'block';
                            
                            // Cuộn đến phần chi tiết sự kiện
                            eventDetails.scrollIntoView({ behavior: 'smooth' });
                        } else {
                            throw new Error(data.message || 'Không thể tải danh sách ghế.');
                        }
                    })
                    .catch(error => {
                        console.error('Error loading event details:', error);
                        
                        // Nếu không tìm thấy ghế, vẫn hiển thị thông tin sự kiện
                        if (error.message.includes('Không tìm thấy ghế nào')) {
                            // Hiển thị thông báo không có ghế
                            seatSelection.innerHTML = '<div class="col-12 text-center"><p>Chưa có ghế nào được tạo cho sự kiện này.</p></div>';
                            
                            // Hiển thị phần chi tiết sự kiện
                            eventsList.style.display = 'none';
                            eventDetails.style.display = 'block';
                            
                            // Cuộn đến phần chi tiết sự kiện
                            eventDetails.scrollIntoView({ behavior: 'smooth' });
                        } else {
                            // Hiển thị thông báo lỗi
                            errorAlert.textContent = error.message || 'Đã xảy ra lỗi khi tải thông tin sự kiện.';
                            errorAlert.style.display = 'block';
                        }
                    })
                    .finally(() => {
                        // Ẩn loading
                        loading.style.display = 'none';
                    });
            }
            
            // Hiển thị danh sách ghế
            function displaySeats(seats) {
                seatSelection.innerHTML = '';
                
                if (!seats || seats.length === 0) {
                    seatSelection.innerHTML = '<div class="col-12 text-center"><p>Chưa có ghế nào được tạo cho sự kiện này.</p></div>';
                    return;
                }
                
                // Tạo container cho từng loại ghế
                const seatTypes = {};
                seats.forEach(seat => {
                    // Kiểm tra xem seat có thuộc tính type không, nếu không thì gán giá trị mặc định
                    const seatType = seat.type || 'Thường';
                    if (!seatTypes[seatType]) {
                        seatTypes[seatType] = [];
                    }
                    seatTypes[seatType].push(seat);
                });
                
                // Hiển thị ghế theo từng loại
                Object.entries(seatTypes).forEach(([type, typeSeats]) => {
                    // Tạo tiêu đề cho loại ghế
                    const typeHeader = document.createElement('div');
                    typeHeader.className = 'col-12 mt-3';
                    
                    // Kiểm tra xem ghế đầu tiên có thuộc tính price không
                    const price = typeSeats[0].price ? typeSeats[0].price.toLocaleString() : '0';
                    typeHeader.innerHTML = `<h5>${type} - ${price} VNĐ</h5>`;
                    seatSelection.appendChild(typeHeader);
                    
                    // Tạo container cho ghế
                    const seatsContainer = document.createElement('div');
                    seatsContainer.className = 'col-12 d-flex flex-wrap gap-2';
                    
                    // Thêm từng ghế vào container
                    typeSeats.forEach(seat => {
                        const seatElement = document.createElement('div');
                        seatElement.className = `seat ${seat.status === 'available' ? 'available' : 'unavailable'}`;
                        seatElement.textContent = seat.seat_number;
                        
                        // Kiểm tra xem ghế có thuộc tính price không
                        const seatPrice = seat.price ? seat.price.toLocaleString() : '0';
                        seatElement.title = `${seat.seat_number} - ${type} - ${seatPrice} VNĐ`;
                        
                        if (seat.status === 'available') {
                            seatElement.addEventListener('click', function() {
                                toggleSeatSelection(seat);
                            });
                        }
                        
                        seatsContainer.appendChild(seatElement);
                    });
                    
                    seatSelection.appendChild(seatsContainer);
                });
                
                // Thêm chú thích
                const legend = document.createElement('div');
                legend.className = 'col-12 mt-3';
                legend.innerHTML = `
                    <div class="d-flex gap-3">
                        <div class="d-flex align-items-center">
                            <div class="seat available me-2"></div>
                            <span>Còn trống</span>
                        </div>
                        <div class="d-flex align-items-center">
                            <div class="seat unavailable me-2"></div>
                            <span>Đã đặt</span>
                        </div>
                        <div class="d-flex align-items-center">
                            <div class="seat selected me-2"></div>
                            <span>Đã chọn</span>
                        </div>
                    </div>
                `;
                seatSelection.appendChild(legend);
            }
            
            // Biến lưu trữ ghế đã chọn
            let selectedSeats = [];
            
            // Chọn/bỏ chọn ghế
            function toggleSeatSelection(seat) {
                // Tìm phần tử ghế trong DOM bằng cách tìm trong tất cả các container ghế
                let seatElement = null;
                const seatContainers = document.querySelectorAll('.col-12.d-flex.flex-wrap.gap-2');
                
                for (const container of seatContainers) {
                    const foundSeat = Array.from(container.children).find(el => 
                        el.textContent === seat.seat_number && 
                        el.classList.contains('seat')
                    );
                    
                    if (foundSeat) {
                        seatElement = foundSeat;
                        break;
                    }
                }
                
                if (!seatElement) {
                    console.error('Không tìm thấy phần tử ghế trong DOM:', seat);
                    return;
                }
                
                if (selectedSeats.some(s => s._id === seat._id)) {
                    // Bỏ chọn ghế
                    selectedSeats = selectedSeats.filter(s => s._id !== seat._id);
                    seatElement.classList.remove('selected');
                } else {
                    // Chọn ghế
                    selectedSeats.push(seat);
                    seatElement.classList.add('selected');
                }
                
                // Cập nhật hiển thị ghế đã chọn và tổng tiền
                updateSelectedSeatsDisplay();
            }
            
            // Cập nhật hiển thị ghế đã chọn và tổng tiền
            function updateSelectedSeatsDisplay() {
                if (selectedSeats.length === 0) {
                    selectedSeatsDisplay.textContent = 'Không có';
                    totalPriceDisplay.textContent = '0';
                } else {
                    selectedSeatsDisplay.textContent = selectedSeats.map(seat => seat.seat_number).join(', ');
                    const totalPrice = selectedSeats.reduce((total, seat) => total + seat.price, 0);
                    totalPriceDisplay.textContent = totalPrice.toLocaleString();
                }
            }
            
            // Xử lý nút đặt vé
            bookButton.addEventListener('click', function() {
                if (!token) {
                    // Nếu chưa đăng nhập, chuyển đến trang đăng nhập
                    window.location.href = 'login/login_signup/login.html';
                    return;
                }
                
                if (selectedSeats.length === 0) {
                    // Hiển thị thông báo lỗi nếu chưa chọn ghế
                    errorAlert.textContent = 'Vui lòng chọn ít nhất một ghế để đặt vé.';
                    errorAlert.style.display = 'block';
                    return;
                }
                
                // Hiển thị loading
                loading.style.display = 'block';
                
                // Tạo dữ liệu đơn hàng
                const orderData = {
                    event_id: currentEventId,
                    seats: selectedSeats.map(seat => seat._id),
                    total_price: selectedSeats.reduce((total, seat) => total + seat.price, 0),
                    status: 'pending',
                    payment_method: 'cash'
                };
                
                // Gửi yêu cầu đặt vé đến API
                fetch('http://localhost:4000/orders', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(orderData)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Không thể đặt vé. Vui lòng thử lại sau.');
                    }
                    return response.json();
                })
                .then(data => {
                    // Ẩn loading
                    loading.style.display = 'none';
                    
                    // Hiển thị thông báo thành công
                    successAlert.textContent = 'Đặt vé thành công! Vui lòng kiểm tra email để xem chi tiết vé.';
                    successAlert.style.display = 'block';
                    
                    // Reset ghế đã chọn
                    selectedSeats = [];
                    updateSelectedSeatsDisplay();
                    
                    // Quay lại danh sách sự kiện sau 2 giây
                    setTimeout(() => {
                        backToList();
                    }, 2000);
                })
                .catch(error => {
                    // Ẩn loading
                    loading.style.display = 'none';
                    
                    // Hiển thị thông báo lỗi
                    errorAlert.textContent = error.message || 'Đã xảy ra lỗi khi đặt vé. Vui lòng thử lại sau.';
                    errorAlert.style.display = 'block';
                });
            });
            
            // Xử lý nút quay lại
            backButton.addEventListener('click', function() {
                backToList();
            });
            
            // Quay lại danh sách sự kiện
            function backToList() {
                eventsList.style.display = 'flex';
                eventDetails.style.display = 'none';
                successAlert.style.display = 'none';
                errorAlert.style.display = 'none';
                
                // Cuộn đến danh sách sự kiện
                eventsList.scrollIntoView({ behavior: 'smooth' });
            }
        });
    </script>
</body>
</html> 